package ru.example.shelter.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import ru.example.shelter.model.Animal;
import ru.example.shelter.model.AnimalType;
import ru.example.shelter.repo.AnimalRepo;

import java.util.List;

@Service //????????? Service ???????? ???????? ????????? Component
public class AnimalService {

    @Autowired
    private AnimalRepo animalRepo;

    public void save(Animal animal) { //????? ??? ?????????? ???????? ? ??
        animalRepo.save(animal);
    }

    public Animal getById(Long id) { //???????? ???????? ?? ??
        return animalRepo.findById(id).orElse(new Animal());
    }

    public void delete(Long id) { //???? ??????? ???????? ?? ?? ?? ??????? ??
        animalRepo.findById(id).ifPresent(animalRepo::delete);
    }

    public List<Animal> getAllNoTakenByType(String type) { //???????? ????? ??? ???????? ?? ????, ???? ?????? ???? ?? ?????????? ?? ?????????? ???? ????????
        try {
            return animalRepo.findAllByTakenAndType(false, AnimalType.valueOf(type.toUpperCase()));
        } catch (Exception e) {
            return animalRepo.findAll();
        }
    }

    public void taken(Long id) { //????????????? ?????? "????" ??? ????????? ?? ??? ??
        animalRepo.findById(id).ifPresent(animal -> {
            animal.setTaken(true);
            animalRepo.save(animal);
        });
    }

    public List<Animal> getAll() {
        return animalRepo.findAll();
    }

    public List<Animal> getAllNoTaken() {
        return animalRepo.findAllByTaken(false);
    }

}
